# General settings
SECRET_KEY: '{{ adjutant_secret_key }}'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG: False
ALLOWED_HOSTS:
  - "*"

ADDITIONAL_APPS:
  - adjutant.api.v1
  - adjutant.actions.v1

DATABASES:
  default:
    ENGINE: django.db.backends.mysql
    NAME: {{ adjutant_galera_database }}
    USER: {{ adjutant_galera_user }}
    PASSWORD: {{ adjutant_container_mysql_password }}
    HOST: {{ adjutant_galera_address }}

LOGGING:
  version: 1
  disable_existing_loggers: False
  handlers:
    file:
      level: INFO
      class: logging.FileHandler
      filename: reg_log.log
  loggers:
    adjutant:
      handlers:
        - file
      level: INFO
      propagate: False
    django:
      handlers:
        - file
      level: INFO
      propagate: False
    keystonemiddleware:
      handlers:
        - file
      level: INFO
      propagate: False

EMAIL_SETTINGS:
  EMAIL_BACKEND: {{ adjutant_email_backend }}
  EMAIL_HOST: {{ adjutant_email_host }}
  EMAIL_PORT: {{ adjutant_email_port }}
  EMAIL_HOST_USER: {{ adjutant_email_host_user }}
  EMAIL_HOST_PASSWORD: {{ adjutant_email_host_password }}
  EMAIL_USE_TLS: {{ adjutant_email_use_tls }}
  EMAIL_USE_SSL: {{ adjutant_email_use_ssl }}

# setting to control if user name and email are allowed
# to have different values.
USERNAME_IS_EMAIL: True

# Keystone config
KEYSTONE:
  username: {{ adjutant_service_user_name }}
  password: {{ adjutant_service_password }}
  project_name: service
  # MUST BE V3 API:
  auth_url: {{ keystone_service_adminurl }}
  domain_id: {{ adjutant_user_domain_id }}
  can_edit_users: True

HORIZON_URL: {{ adjutant_horizon_publicurl }}

# time for the token to expire in hours
TOKEN_EXPIRE_TIME: 24

ACTIVE_TASKVIEWS:
{{ adjutant_active_taskviews | to_nice_yaml(indent=2, width=140) | indent(2, True) }}

DEFAULT_TASK_SETTINGS:
  emails:
    initial:
      subject: Initial Confirmation
      reply: {{ adjutant_email_reply_address }}
      from: {{ adjutant_email_from_address }}
      template: initial.txt
      # html_template: initial.txt
    # If the related actions 'can' send a token,
    # this field should here.
    token:
      subject: Your Token
      reply: {{ adjutant_email_reply_address }}
      from: {{ adjutant_email_from_address }}
      template: token.txt
      # html_template: token.txt
    completed:
      subject: Task completed
      reply: {{ adjutant_email_reply_address }}
      from: {{ adjutant_email_from_address }}
      template: completed.txt
      # html_template: completed.txt
  notifications:
    EmailNotification:
      standard:
        emails:
          - {{ adjutant_email_notification_address }}
        reply: {{ adjutant_email_reply_address }}
        from: {{ adjutant_email_from_address }}
        template: notification.txt
        # html_template: completed.txt
      error:
        emails:
          - {{ adjutant_email_notification_address }}
        reply: {{ adjutant_email_reply_address }}
        from: {{ adjutant_email_from_address }}
        template: notification.txt
        # html_template: completed.txt

# Default Action settings:
# These can be overridden at a per task level below in the
# task settings so that multiple tasks can use the same actions
# slightly differently.
#
# TASK_SETTINGS:
#   <task_type>:
#     <othersettings> ....
#       ....
#     action_settings:
#       <action_class_name>:
#         <action_settings_overrides> ....
DEFAULT_ACTION_SETTINGS:
  NewProjectAction:
    default_roles:
      - project_admin
      - project_mod
      - heat_stack_owner
      - _member_
      - creator
      - swiftoperator
      - load-balancer_admin
  NewProjectWithUserAction:
    default_roles:
      - project_admin
      - project_mod
      - heat_stack_owner
      - _member_
      - creator
      - swiftoperator
      - load-balancer_admin
  NewUserAction:
    allowed_roles:
      - project_admin
      - project_mod
      - heat_stack_owner
      - _member_
      - creator
      - swiftoperator
      - load-balancer_admin
  ResetUserPasswordAction:
    blacklisted_roles:
      - admin
  NewDefaultNetworkAction:
    "{{ adjutant_service_region }}":
      network_name: default_network
      subnet_name: default_subnet
      router_name: default_router
      public_network: 04b958fd-5edc-4210-a0ca-8d8b065f9ed6
      DNS_NAMESERVERS:
        - 8.8.8.8
        - 8.8.4.4
      SUBNET_CIDR: 192.168.1.0/24
  NewProjectDefaultNetworkAction:
    "{{ adjutant_service_region }}":
      network_name: default_network
      subnet_name: default_subnet
      router_name: default_router
      public_network: 04b958fd-5edc-4210-a0ca-8d8b065f9ed6
      DNS_NAMESERVERS:
        - 8.8.8.8
        - 8.8.4.4
      SUBNET_CIDR: 192.168.1.0/24
  AddDefaultUsersToProjectAction:
    default_users:
      - cloudkitty
    default_roles:
      - rating
  SetProjectQuotaAction:
    regions:
      "{{ adjutant_service_region }}":
        quota_size: {{ adjutant_default_quota_size }}
  UpdateProjectQuotasAction:
    days_between_autoapprove: {{ adjutant_quota_auto_approve_days }}
  SendAdditionalEmailAction:
    initial:
      email_current_user: False
      reply: {{ adjutant_email_reply_address }}
      from: {{ adjutant_email_from_address }}
      subject: "Openstack Email Notification"
      template: null
    token:
      email_current_user: False
      reply: {{ adjutant_email_reply_address }}
      from: {{ adjutant_email_from_address }}
      subject: "Openstack Email Notification"
      template: null
    completed:
      email_current_user: False
      reply: {{ adjutant_email_reply_address }}
      from: {{ adjutant_email_from_address }}
      subject: "Openstack Email Notification"
      template: null
      # A null template will cause the email not to send
      # Also emails to the given roles on the project
      # email_roles:
      #   - project_admin
      # Or sends to an email set in the task cache
      # email_task_cache: True
      # Or sends to an arbitrary admin email
      # email_additional_addresses:
      #   - admin@example.org

# These are cascading overrides for the default settings:
TASK_SETTINGS:
  signup:
    # You can override 'default_actions' if needed for given taskviews
    # The order of the actions is order of execution.
    #
    # default_actions:
    #     - NewProjectAction
    #
    # Additional actions for views
    # These will run after the default actions, in the given order.
    additional_actions:
      - NewProjectDefaultNetworkAction
      - SetProjectQuotaAction
    emails:
      initial:
        subject: Your OpenStack signup has been received
        template: signup_initial.txt
      token:
        subject: Your OpenStack signup has been approved
        template: signup_token.txt
      completed:
        subject: Your OpenStack signup has been completed
        template: signup_completed.txt
    notifications:
      EmailNotification:
        standard:
          emails:
            - {{ adjutant_email_signups_notification_address }}
        error:
          emails:
            - {{ adjutant_email_signups_notification_address }}
    default_region: {{ adjutant_service_region }}
    # If 'None' (null in yaml) will default to domain as parent.
    # If domain isn't set explicity will service user domain (see KEYSTONE).
    default_parent_id: null
  invite_user:
    duplicate_policy: cancel
    emails:
      # To not send this email set the value to null
      initial: null
      token:
        subject: Invitation to an OpenStack project
        template: invite_user_token.txt
      completed:
        subject: Invitation Completed
        template: invite_user_completed.txt
    errors:
      SMTPException:
        notification: acknowledge
        engines: False
  reset_password:
    duplicate_policy: cancel
    emails:
      initial: null
      token:
        subject: Password Reset for OpenStack
        template: password_reset_token.txt
      completed:
        subject: Password Reset Completed
        template: password_reset_completed.txt
  force_password:
    duplicate_policy: cancel
    emails:
      initial: null
      token:
        subject: Set your OpenStack password
        template: initial_password_token.txt
      completed:
        subject: Welcome to OpenStack!
        template: initial_password_completed.txt
  edit_user:
    duplicate_policy: cancel
    emails:
      initial: null
      token: null
    role_blacklist:
      - admin
  edit_roles:
    duplicate_policy: cancel
    emails:
      initial: null
      token: null
  update_email:
    duplicate_policy: cancel
    additional_actions:
      - SendAdditionalEmailAction
    emails:
      initial: null
      token:
        subject: Confirm OpenStack Email Update
        template: email_update_token.txt
      completed:
        subject: OpenStack Email Updated
        template: email_update_completed.txt
    action_settings:
      SendAdditionalEmailAction:
        initial:
          subject: OpenStack Email Update Requested
          template: email_update_started.txt
          email_current_user: True
  update_quota:
    allow_auto_approve: {{ adjutant_quota_allow_auto_approve | bool }}
    duplicate_policy: cancel
    size_difference_threshold: 0.1
    emails:
      initial: null
      token: null
      completed:
        subject: Openstack Quota updated
        template: quota_completed.txt

# mapping between roles and managable roles
ROLES_MAPPING:
{{ adjutant_role_mapping | to_nice_yaml(indent=2, width=140) | indent(2, True) }}

PROJECT_QUOTA_SIZES:
{{ adjutant_quota_sizes | to_nice_yaml(indent=2, width=140) | indent(2, True) }}

# Time in seconds to cache token from Keystone
TOKEN_CACHE_TIME: 0

# Ordered list of quota sizes from smallest to biggest
QUOTA_SIZES_ASC:
{{ adjutant_quota_sizes_asc | to_nice_yaml(indent=2, width=140) | indent(2, True) }}

# Services to check through the quotas for
QUOTA_SERVICES:
{{ adjutant_quota_services | to_nice_yaml(indent=2, width=140) | indent(2, True) }}
